{"version":3,"file":"js/84.5e74af28081cbc87ac35.js","mappings":"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","sources":["webpack:///./src/Components/SmartComponents/Reports/Common/FooterPDF.js","webpack:///./src/Components/SmartComponents/Reports/DownloadCVEsReport.js"],"sourcesContent":["import React from 'react';\nimport propTypes from 'prop-types';\nimport { View, Text } from '@react-pdf/renderer';\nimport styles from './styles';\nimport messages from '../../../../Messages';\nimport { intlFormatWithBold } from '../../../../Helpers/ReportsHelper';\n\nconst FooterPDF = ({ hasRule, hasExploit }) => {\n\n    return (\n        <View>\n            { hasExploit && (\n                <Text style={styles.footer}>\n                    {intlFormatWithBold(messages.knownExploitPDFFooter)}\n                </Text>\n            )}\n\n            { hasRule && (\n                <Text style={styles.footer}>\n                    {intlFormatWithBold(messages.securityRulePDFFooter)}\n                </Text>\n            )}\n\n        </View>\n    );\n};\n\nFooterPDF.propTypes = {\n    hasRule: propTypes.bool,\n    hasExploit: propTypes.bool\n};\n\nexport default FooterPDF;\n","\nimport React, { useState, useEffect } from 'react';\nimport propTypes from 'prop-types';\nimport { useIntl } from 'react-intl';\nimport { DownloadButton } from '@redhat-cloud-services/frontend-components-pdf-generator';\nimport { getCveListByAccount } from '../../../Helpers/APIHelper';\nimport { chunkArray } from '../../../Helpers/MiscHelper';\nimport { firstPagePDFLength, otherPagesPDFLength } from '../../../Helpers/ReportsHelper';\nimport messages from '../../../Messages';\nimport firstPagePDF from './Common/firstPagePDF';\nimport tablePage from './Common/tablePage';\nimport FooterPDF from './Common/FooterPDF';\nimport DownloadReport from '../../../Helpers/DownloadReport';\nimport { STATUS_OPTIONS, BUSINESS_RISK_OPTIONS, impactList } from '../../../Helpers/constants';\nimport { useNotification } from '../../../Helpers/Hooks';\n\nconst DownloadCVEsReport = ({\n    filters,\n    params,\n    reportData = {},\n    buttonProps,\n    isReportDynamic = false,\n    label,\n    ...props\n}) => {\n    const intl = useIntl();\n    const [loading, setLoading] = useState(false);\n    const [hasRule, setSecurityRulesPresent] = useState(false);\n    const [hasExploit, setExploit] = useState(false);\n    const [addNotification, clearNotifications] = useNotification();\n\n    useEffect(() => {\n        setLoading(true);\n        addNotification({ msg: intl.formatMessage(messages.notificationReportDownloadStart) });\n    }, []);\n\n    const otherPagesPDF = data => chunkArray(\n        data,\n        otherPagesPDFLength(reportData, params),\n        (total, { attributes }) => total + (attributes.rules.length > 0)\n    );\n\n    const cvesFetch = async () => {\n        let cves;\n        let meta;\n\n        try {\n            ({ data: cves, meta } = await getCveListByAccount({\n                ...params,\n                ...DownloadReport.defaultParams,\n                sort: params.sort || '-cvss_score',\n                affecting: 'true'\n            }));\n        }\n        catch {\n            clearNotifications();\n            addNotification({\n                variant: 'danger',\n                autoDismiss: false,\n                msg: intl.formatMessage(messages.notificationReportDownloadFailureTitle),\n                description: intl.formatMessage(messages.notificationReportDownloadFailureBody)\n            });\n\n            return [];\n        }\n\n        let user;\n        if (reportData && reportData.userNotes) {\n            user = await insights.chrome.auth.getUser();\n        }\n\n        const processData = (cves, meta) => {\n            meta.knownExploitCount = cves.filter(({ attributes }) => attributes.known_exploit === true).length;\n\n            return cves.map(cve => {\n                if (!meta.hasRule) {\n                    meta.hasRule = cve.attributes.rules.length > 0;\n                }\n\n                return {\n                    ...cve,\n                    attributes: {\n                        ...cve.attributes,\n                        status: STATUS_OPTIONS.find(item =>\n                            item.value === cve.attributes.status_id.toString()).label,\n                        business_risk: BUSINESS_RISK_OPTIONS.find(item =>\n                            item.value === cve.attributes.business_risk_id.toString()).label,\n                        impact: impactList[cve.attributes.impact]?.title || intl.formatMessage(messages.impactListUnknown),\n                        cvss_score: parseFloat(cve.attributes.cvss3_score || cve.attributes.cvss2_score).toFixed(1)\n                    }\n                };\n            });\n        };\n\n        const data = processData(cves, meta);\n\n        setSecurityRulesPresent(() => {\n            return isReportDynamic ? meta.hasRule && reportData && reportData.header?.includes('rule_presence') : meta.hasRule;\n        });\n\n        setExploit(() => {\n            return isReportDynamic\n                ? meta.knownExploitCount > 0 && reportData && reportData.header?.includes('known_exploit')\n                : meta.knownExploitCount > 0;\n        });\n\n        const firstPage = firstPagePDF({\n            data: data.splice(0, firstPagePDFLength(reportData, params)),\n            meta,\n            filters,\n            intl,\n            isReportDynamic,\n            reportData,\n            user,\n            type: 'cves' // FIXME: firstPagePDF should be more abstract\n        });\n\n        const otherPages = otherPagesPDF(data);\n\n        setLoading(false);\n\n        clearNotifications();\n        addNotification({ variant: 'success', msg: intl.formatMessage(messages.notificationReportDownloadSuccess) });\n\n        return [\n            firstPage,\n            ...otherPages.map((cvePage, index) =>\n                tablePage({\n                    data: cvePage,\n                    page: index,\n                    intl,\n                    header: reportData && reportData.header,\n                    type: 'cves', // FIXME: same for tablePage\n                    isReportDynamic\n                })\n            )\n        ];\n    };\n\n    return (\n        <div>\n            <DownloadButton\n                fallback={null}\n                orientation={'landscape'}\n                size={'A4'}\n                type={''}\n                fileName={`${DownloadReport.filename(isReportDynamic ? 'reports' : '')}.pdf`}\n                buttonProps={{ component: 'button', ...buttonProps }}\n                asyncFunction={cvesFetch}\n                allPagesHaveTitle={false}\n                footer={<FooterPDF intl={intl} hasRule={hasRule} hasExploit={hasExploit} />}\n                reportName={\n                    isReportDynamic\n                        ? reportData.reportTitle\n                        : intl.formatMessage(messages.cvePDFReportName)\n                }\n                label={\n                    loading\n                        ? intl.formatMessage(messages.loading)\n                        : intl.formatMessage(label)\n                }\n                {...props}\n            />\n        </div>\n    );\n};\n\nDownloadCVEsReport.defaultProps = {\n    label: messages.kebabExportAsPDF\n};\n\nDownloadCVEsReport.propTypes = {\n    filters: propTypes.oneOfType([\n        propTypes.array,\n        propTypes.object\n    ]),\n    params: propTypes.object,\n    reportData: propTypes.object,\n    buttonProps: propTypes.object,\n    label: propTypes.oneOfType([\n        propTypes.array,\n        propTypes.object\n    ]),\n    isReportDynamic: propTypes.bool\n};\n\nexport default DownloadCVEsReport;\n"],"names":["FooterPDF","hasRule","hasExploit","style","styles","intlFormatWithBold","messages","propTypes","DownloadCVEsReport","filters","params","reportData","buttonProps","isReportDynamic","label","props","intl","useIntl","useState","loading","setLoading","setSecurityRulesPresent","setExploit","useNotification","addNotification","clearNotifications","useEffect","msg","formatMessage","otherPagesPDF","data","chunkArray","otherPagesPDFLength","total","attributes","rules","length","cvesFetch","getCveListByAccount","DownloadReport","sort","affecting","cves","meta","variant","autoDismiss","description","userNotes","insights","chrome","auth","getUser","user","processData","knownExploitCount","filter","known_exploit","map","cve","status","STATUS_OPTIONS","item","value","status_id","toString","business_risk","BUSINESS_RISK_OPTIONS","business_risk_id","impact","impactList","title","cvss_score","parseFloat","cvss3_score","cvss2_score","toFixed","header","includes","firstPage","firstPagePDF","splice","firstPagePDFLength","type","otherPages","cvePage","index","tablePage","page","fallback","orientation","size","fileName","component","asyncFunction","allPagesHaveTitle","footer","reportName","reportTitle","defaultProps"],"sourceRoot":""}