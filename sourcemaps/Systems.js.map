{"version":3,"sources":["webpack:///./src/Components/SmartComponents/Systems/Systems.js"],"names":["Systems","props","_this","_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_3___default","this","_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_5___default","_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_6___default","call","filterChange","debounce","value","page_size","systems","meta","setState","_babel_runtime_helpers_objectSpread__WEBPACK_IMPORTED_MODULE_2___default","state","filter","fetchData","checkItem","bind","_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_8___default","onRefresh","InventoryCmp","react__WEBPACK_IMPORTED_MODULE_19___default","a","createElement","removeListener","columns","key","title","composed","isTime","fetchInventory","insights","loadInventory","react","React","reactRouterDom","reactCore","reactIcons","pfReactTable","pfReact","PaginationRow","inventoryConnector","mergeWithEntities","mergeWithDetail","ReducerRegistry","register","inventoryEntitiesReducer","InventoryTable","newList","systemList","selected","page","_ref2","perPage","per_page","_this$props$systems","data","_patternfly_react_core__WEBPACK_IMPORTED_MODULE_10__","_VulnerabilityHeader_VulnerabilityHeader__WEBPACK_IMPORTED_MODULE_29__","_redhat_cloud_services_frontend_components__WEBPACK_IMPORTED_MODULE_15__","hasCheckbox","total","total_items","items","map","item","id","attributes","inventory_id","_patternfly_react_core__WEBPACK_IMPORTED_MODULE_11__","className","_patternfly_react_core__WEBPACK_IMPORTED_MODULE_12__","onFilterChange","buttonTitle","placeholder","Component","propTypes","func","setHeader","dataShape","withRouter","connect","sAllSystems","header","dispatchAction","options","fetchSystems"],"mappings":"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","file":"js/Systems.js","sourcesContent":["import * as reactCore from '@patternfly/react-core';\nimport { Page, ToolbarGroup, ToolbarItem } from '@patternfly/react-core';\nimport * as reactIcons from '@patternfly/react-icons';\nimport * as pfReactTable from '@patternfly/react-table';\nimport { Main, SimpleTableFilter } from '@redhat-cloud-services/frontend-components';\nimport debounce from 'lodash/debounce';\nimport { PaginationRow } from 'patternfly-react';\nimport propTypes from 'prop-types';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport * as reactRouterDom from 'react-router-dom';\nimport { withRouter } from 'react-router-dom';\nimport { dispatchAction } from '../../../Helpers/Dispatcher';\nimport { dataShape } from '../../../Helpers/MiscHelper';\nimport { fetchSystems, setHeader } from '../../../Store/Actions/Actions';\nimport { inventoryEntitiesReducer } from '../../../Store/Reducers/InventoryEntitiesReducer';\nimport { sAllSystems } from '../../../Store/Selectors/CVESelectors';\nimport ReducerRegistry from '../../../Utilities/ReducerRegistry';\nimport VulnerabilityHeader from '../VulnerabilityHeader/VulnerabilityHeader';\n\n/*eslint camelcase: 0*/\n\nclass Systems extends React.Component {\n    constructor(props) {\n        super(props);\n        this.checkItem = this.checkItem.bind(this);\n        this.onRefresh = this.onRefresh.bind(this);\n        this.filterChange = this.filterChange.bind(this);\n        this.state = {\n            InventoryCmp: () => <div>Loading...</div>,\n            filter: '',\n            removeListener: () => {},\n            columns: [\n                { key: 'display_name', title: 'Name', composed: ['facts.os_release', 'display_name'] },\n                { key: 'cve_count', title: 'CVEs' },\n                { key: 'updated', title: 'Last Seen', isTime: true }\n            ]\n        };\n    }\n\n    componentDidMount() {\n        this.props.fetchData();\n        this.fetchInventory();\n    }\n\n    async fetchInventory() {\n        const { inventoryConnector, mergeWithEntities, mergeWithDetail } = await insights.loadInventory({\n            react: React,\n            reactRouterDom,\n            reactCore,\n            reactIcons,\n            pfReactTable,\n            pfReact: { PaginationRow }\n        });\n        ReducerRegistry.register({\n            ...mergeWithEntities(inventoryEntitiesReducer(this.state.columns)),\n            ...mergeWithDetail()\n        });\n\n        this.setState({\n            InventoryCmp: inventoryConnector().InventoryTable\n        });\n        this.state.removeListener();\n    }\n\n    checkItem(key, value) {\n        let newList = this.state.systemList;\n        newList[key].selected = value;\n        this.setState({ systemList: newList });\n    }\n\n    filterChange = debounce(value => {\n        const { meta } = this.props.systems;\n        const { page_size } = meta;\n        this.setState({ ...this.state, filter: value }, () => this.props.fetchData({ page_size, filter: this.state.filter }));\n    }, 400);\n\n    onRefresh({ page, per_page: perPage }) {\n        const { meta } = this.props.systems;\n        if (meta.page !== page || meta.page_size !== perPage) {\n            this.props.fetchData({\n                page: meta.page_size !== perPage ? 1 : page,\n                page_size: perPage,\n                filter: this.state.filter\n            });\n        }\n    }\n\n    render() {\n        const { InventoryCmp } = this.state;\n        const { data, meta } = this.props.systems;\n        return (\n            <Page>\n                <VulnerabilityHeader title=\"Systems\" />\n                <Main>\n                    <InventoryCmp\n                        hasCheckbox={false}\n                        page={meta.page}\n                        total={meta.total_items}\n                        perPage={meta.page_size}\n                        onRefresh={this.onRefresh}\n                        items={data.map(item => ({\n                            id: item.attributes.inventory_id,\n                            ...item.attributes\n                        }))}\n                    >\n                        <ToolbarGroup className=\"systems-toolbar\">\n                            <ToolbarItem>\n                                <SimpleTableFilter\n                                    onFilterChange={this.filterChange}\n                                    buttonTitle={null}\n                                    placeholder=\"Find a system by UUID\"\n                                />\n                            </ToolbarItem>\n                        </ToolbarGroup>\n                    </InventoryCmp>\n                </Main>\n            </Page>\n        );\n    }\n}\n\nSystems.propTypes = {\n    fetchData: propTypes.func,\n    setHeader: propTypes.func,\n    systems: dataShape\n};\n\nfunction mapStateToProps(state) {\n    return {\n        systems: sAllSystems(state)\n    };\n}\n\nconst mapDispatchToProps = () => {\n    return {\n        setHeader: header => dispatchAction(setHeader(header)),\n        fetchData: options => dispatchAction(fetchSystems(options))\n    };\n};\n\nexport default withRouter(\n    connect(\n        mapStateToProps,\n        mapDispatchToProps\n    )(Systems)\n);\n"],"sourceRoot":""}