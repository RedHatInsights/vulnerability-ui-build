{"version":3,"sources":["webpack:///./src/Store/Reducers/InventoryEntitiesReducer.js","webpack:///./src/Components/SmartComponents/Systems/Systems.scss?4fb1","webpack:///./src/Components/SmartComponents/Systems/Systems.scss","webpack:///./src/Components/SmartComponents/Systems/SystemsTableToolbar.js","webpack:///./src/Components/SmartComponents/Systems/Systems.js"],"names":["init","columns","rows","entities","selectedRows","modifyInventory","state","loaded","lastSeenColumn","filter","key","map","item","selected","some","system","id","selectEntities","myRows","slice","inventoryEntitiesReducer","action","type","payload","row","isOpen","content","module","i","options","transform","undefined","locals","exports","push","SystemsTableToolbar","props","useState","middlewareListener","addNew","on","callback","newSelected","data","selectedHosts","handleSelect","onSelect","handleRefresh","page","pageSize","page_size","optOut","opt_out","meta","systems","config","params","allParams","allowedParams","Object","keys","forEach","includes","queryString","qs","stringify","setFilter","history","createUrlParams","kebabOptions","label","intl","formatMessage","messages","kebabResumeAnalysis","kebabExcludeVulnerabilityAnalysis","onClick","doOptOut","isDisabled","length","kebabHideExcludedSystems","kebabShowExcludedSystems","setOptOut","setSelectedHosts","setPage","selectOptions","selectAllCheckbox","selectedItems","selectorHandler","items","fetchResource","ops","fetchSystems","bulkSelect","count","checked","Boolean","handleOnCheckboxChange","actionsConfig","actions","dropdownProps","className","filterConfig","searchFilter","systemsSearchName","searchFilterByName","f","onRefresh","activeFiltersConfig","filters","buildActiveFilters","parameters","onDelete","e","removeFilters","exportConfig","downloadReport","format","DownloadReport","exec","propTypes","dataShape","func","array","any","object","withRouter","injectIntl","SystemsHook","location","InventoryTable","setInventoryTable","parse","search","inventory","React","createRef","dispatch","useDispatch","useSelector","SystemsStore","metadata","isLoading","useMemo","attributes","cveCount","cve_count","rest","inventory_id","useEffect","constructor","loadInventory","a","insights","react","reactRouterDom","reactCore","reactIcons","pfReactTable","inventoryConnector","mergeWithEntities","mergeWithDetail","ReducerRegistry","register","SYSTEMS_HEADER","getStore","selectMultipleEntities","perPage","per_page","changeSystemsParams","total_items","current","onRefreshData","systemId","optOutSystemsAction","then","addNotification","variant","title","systemsExcludedNotification","systemsResumedNotificationTitle","description","systemsResumedNotificationBody","VulnerabilityHeader","showBreadcrumb","ref","total","isLoaded","hasCheckbox","systemTableRowActions","isChecked"],"mappings":"8sBACO,IAAMA,EAAO,CAChBC,QAAS,GACTC,KAAM,GACNC,SAAU,GACVC,aAAc,IAIlB,SAASC,EAAgBJ,EAASK,GAG9B,GAFKA,EAAMF,eAAeE,EAAMF,aAAe,IAE3CE,EAAMC,OAAQ,CACd,IAAMC,EAAiBF,EAAML,QAAQQ,OAAO,kBAAqB,YAArB,EAAGC,MAC/C,YACOJ,EADP,CAEIJ,KAAMI,EAAMJ,KAAKS,IAAI,SAAAC,GAAI,YAAUA,EAAV,CAAgBC,SAAUP,EAAMF,aAAaU,KAAK,SAAAC,GAAM,OAAIA,IAAWH,EAAKI,SACrGf,QAAS,GAAF,WACAA,GAAW,IADX,IAEAO,GAAkB,OAKjC,OAAOF,EAGX,SAASW,EAAeX,EAAOO,GAC3B,IAAMK,EAASZ,EAAMJ,KAAKiB,QAY1B,OAXKb,EAAMF,eAAeE,EAAMF,aAAe,IAEhC,EAAH,GACLE,EADK,CAERJ,KAAMgB,EACLP,IAAI,SAAAC,GAED,OADiB,EAAH,GAASA,EAAT,CAAeC,SAAUA,EAASC,KAAK,SAAAC,GAAM,OAAIA,IAAWH,EAAKI,SAGnFZ,aAAc,IAAIS,KAKnB,IAAMO,EAA2B,SAACnB,GAAD,OAAa,WAA0B,IAAzBK,EAAyB,uDAAjBN,EAAMqB,EAAW,uCAC3E,OAAQA,EAAOC,MACX,IAAK,0BACD,OAAOjB,EAAgBJ,EAASK,GACpC,IAAK,2BACD,OAAOW,EAAeX,EAAOe,EAAOE,SACxC,IAAK,aACD,YACOjB,EADP,CAEIJ,KAAMI,EAAMJ,KAAKS,IAAI,SAAAa,GAAG,YACjBA,EADiB,CAEpBC,OAAQD,EAAIR,KAAOK,EAAOE,QAAQP,GAAKK,EAAOE,QAAQE,OAASD,EAAIC,aAG/E,QACI,OAAOnB,M,qBCzDnB,IAAIoB,EAAU,EAAQ,MAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAACC,EAAOC,EAAIF,EAAS,MAOhE,IAAIG,EAAU,CAAC,KAAM,EAErB,eAPIC,EAQJ,gBAAqBC,GAER,EAAQ,GAAR,CAAmEL,EAASG,GAEtFH,EAAQM,SAAQL,EAAOM,QAAUP,EAAQM,S,sBCjBlCL,EAAOM,QAAU,EAAQ,GAAR,EAA+D,IAKlFC,KAAK,CAACP,EAAOC,EAAI,+dAAge,M,m5BCWzf,IAAMO,EAAsB,SAACC,GAEzB,IAFmC,EAUVC,mBAASC,IAAmBC,OAAO,CACxDC,GAAI,gBACJC,SAAU,SAAAlB,GAAO,OAVJ,SAACA,GACd,IAAMmB,EAAcnB,EAAQoB,KAAK9B,SAAb,CAAyBU,EAAQoB,KAAK3B,IAAtC,WAA6CoB,EAAMQ,gBACjER,EAAMQ,cAAcnC,OAAO,SAAAG,GAAI,OAAIA,IAASW,EAAQoB,KAAK3B,KAE/DoB,EAAMS,cAAa,EAAOH,GAMLI,CAASvB,OAsB5BwB,GAlC6B,YAkCb,SAAC,EAAwDN,GAAa,IAAnEO,EAAmE,EAAnEA,KAAiBC,EAAkD,EAA7DC,UAAqBzC,EAAwC,EAAxCA,OAAiB0C,EAAuB,EAAhCC,QAChDC,EAASjB,EAAMkB,QAAfD,KACR,GAAIA,EAAKL,OAASA,GAAQK,EAAKH,YAAcD,EAAU,CACnD,IAAMM,EAAS,CACXP,OACAE,UAAWD,GAAYI,EAAKH,UAC5BzC,SACA2C,QAASD,GAAUf,EAAMoB,SAASJ,SAGtC,GA7BgB,SAAAK,GACpB,IAAMD,EAAS,EAAH,GAAQC,GACdC,EAAgB,CAAC,SAAU,OAAQ,aACzCC,OAAOC,KAAKH,GAAWI,QACnB,SAAAnD,GAAG,YACkBqB,IAAhByB,EAAO9C,IAAsC,KAAhB8C,EAAO9C,KAAgBgD,EAAcI,SAASpD,KAAwB,IAAhB8C,EAAO9C,YACpF8C,EAAO9C,KAEtB,IAAMqD,EAAcC,IAAGC,UAAUT,GAEjCpB,EAAM8B,UAAUT,EAAUhD,QAC1B2B,EAAM+B,QAAQjC,KAAK,IAAM6B,GAiBrBK,CAAgBb,GACZd,EAAW,OAAOA,EAASc,MAUjCc,EAAe,CACjB,GACA,CACIC,MAAOlC,EAAMoB,SAASJ,QAAUhB,EAAMmC,KAAKC,cAAcC,IAASC,qBAC5DtC,EAAMmC,KAAKC,cAAcC,IAASE,mCACxCC,QAAS,kBAAMxC,EAAMyC,YACrBzC,MAAO,CAAE0C,YAAa1C,EAAMQ,cAAcmC,SAE9C,CACIT,MAAOlC,EAAMoB,SAASJ,QAAUhB,EAAMmC,KAAKC,cAAcC,IAASO,0BAC5D5C,EAAMmC,KAAKC,cAAcC,IAASQ,0BACxCL,QAjBa,WACjBxC,EAAM8C,WAAW9C,EAAMoB,SAASJ,SAChChB,EAAM+C,iBAAiB,IACvB/C,EAAMgD,QAAQ,MAkBZC,EAAgBC,YAAkB,CACpCC,cAAenD,EAAMQ,cACrB4C,gBAAiBpD,EAAMS,aACvB4C,MAAOrD,EAAMkB,QACboC,cAAe,SAAAC,GAAG,OAAG5C,EAAc4C,EAAK,SAACpC,GAAD,OAAYqC,YAAarC,QAGrE,OACI,kBAAC,iBAAD,CACIsC,WAAY,CACRC,MAAO1D,EAAMQ,cAAcmC,OAC3BU,MAAOJ,EAAcI,MACrBM,QAASC,QAAQ5D,EAAMQ,cAAcmC,QACrCjC,SAAU,kBAAMuC,EAAcY,2BAElCC,cAAe,CACXC,QAAS9B,EACT+B,cAAe,CAAEC,UAAW,iBAEhCC,aAAc,CACVb,MAAO,CACHc,YACI9B,IAAS+B,kBACT/B,IAASgC,mBACTrE,EAAMoB,SAAS/C,OACf,SAACiG,GAAD,OAAO3D,EAAc2D,EAAGtE,EAAMuE,eAI1CC,oBAAqB,CACjBC,QAASC,YAAmB1E,EAAM2E,YAClCC,SAAU,SAACC,EAAGrF,GAAJ,OAAUsF,YAActF,EAAG,SAAC8E,GAAD,OAAO3D,EAAc2D,EAAGtE,EAAMuE,eAEvEQ,aAAcA,YAAa,CAAEC,eAzEd,SAAAC,GACnB,IAAI7D,EAAS,EAAH,GAAQpB,EAAMoB,QACxB8D,IAAeC,KAAK3B,IAAcpC,EAAS6D,EAAQ,qBA+E3DlF,EAAoBqF,UAAY,CAC5BlE,QAASmE,IACTjE,OAAQgE,IAAUE,KAClBtC,QAASoC,IAAUE,KACnBxD,UAAWsD,IAAUE,KACrBxC,UAAWsC,IAAUE,KACrB9E,cAAe4E,IAAUG,MACzBxC,iBAAkBqC,IAAUE,KAC5B7C,SAAU2C,IAAUE,KACpBf,UAAWa,IAAUI,IACrBb,WAAYS,IAAUK,OACtBhF,aAAc2E,IAAUE,KACxBvD,QAASqD,IAAUK,OACnBtD,KAAMiD,IAAUI,KAGLE,kBACXC,YAAW5F,I,ylBC1Hf,IAYM6F,EAAc,SAAC,GAAuB,IAArBzD,EAAqB,EAArBA,KAAM0D,EAAe,EAAfA,SAAe,EACI5F,mBAAS,kBAAM,kBAAM,8CADzB,WACjC6F,EADiC,KACjBC,EADiB,OAEZ9F,mBAAS2B,IAAGoE,MAAMH,EAASI,QAAQ5H,QAFvB,WAEjCA,EAFiC,KAEzByD,EAFyB,OAGE7B,wBAASN,GAHX,WAGjCa,EAHiC,KAGlBuC,EAHkB,OAIZ9C,oBAAS,GAJG,WAIjCc,EAJiC,KAIzB+B,EAJyB,OAKhB7C,mBAAS,GALO,WAKjCW,EALiC,KAK3BoC,EAL2B,OAMrB/C,mBAAS,IAArBY,EANiC,YAOlCqF,EAAYC,IAAMC,YAClBC,EAAWC,wBAEXpF,EAAUqF,sBAAY,qBAAGC,aAAgCrH,UAEzDwF,EAAa4B,sBACf,qBAAGC,aAA+BpF,SAGhCqF,EAAWF,sBACb,qBAAGC,aAAgCC,WAEjCC,EAAaH,sBAAY,qBAAGC,aAAgCE,YAE5DrD,GAAQsD,kBAAQ,kBAjCHpG,GAAF,EAiCuBW,GAjCrBX,KAAMU,EAAW,EAAXA,KACXV,GAAQA,EAAKhC,IAAI,SAAAC,GAAQ,MACMA,EAAKoI,WAA3BC,EADgB,EAC3BC,UAAwBC,EADG,qBAEnC,UACID,UAAY7F,EAAKD,QAAW,WAAe6F,EAC3CjI,GAAIJ,EAAKoI,WAAWI,cACjBD,MAGK,GATA,IAAC,EAAExG,EAAMU,GAiCyB,CAACC,IAE7CE,GAAS,iBAAO,CAAE/C,SAASyC,UAAWD,EAAUG,QAASD,EAAQH,SAEvEqG,oBAAU,WACiC,IAAnC1F,OAAOC,KAAKmD,GAAYhC,QAAgBgC,EAAWuC,cAAgB3F,QACnE8E,EAAS7C,YAAamB,KAE3B,CAACA,EAAY0B,IAEhB,IAAMc,GAAa,8BAAG,sCAAAC,EAAA,qEAKRC,SAASF,cAAc,CAC7BG,MAAOnB,IACPoB,iBACAC,YACAC,aACAC,iBAVc,gBAEdC,EAFc,EAEdA,mBACAC,EAHc,EAGdA,kBACAC,EAJc,EAIdA,gBASJC,IAAgBC,SAAhB,KACOH,EACC5I,YAAyBgJ,MAFjC,GAIOH,MAjBW,EAmBSF,EAAmBG,IAAgBG,YAAtDnC,EAnBU,EAmBVA,eAERC,EAAkB,kBAAMD,IArBN,yCAAH,qDAwBnBmB,oBAAU,WACNE,MACD,IAEHF,oBAAU,WACFzG,GACA6F,EAAS6B,YAAuB1H,KAErC,CAACA,EAAe6F,IAEnBY,oBAAU,WACDP,GACDL,EAAS7C,YAAa,KAAKpC,SAGhC,CAACL,IAEJ,IAAMwD,GAAY,SAAC,GAAyD,IAAvD3D,EAAuD,EAAvDA,KAAgBuH,EAAuC,EAAjDC,SAA4BrH,EAAqB,EAA9BC,QAAiB3C,EAAa,EAAbA,OACvDoI,EAAS7F,OAASA,GAAQ6F,EAAS3F,YAAcqH,GACjD9B,EAASgC,YAAoB,CAAEzH,OAAMwH,SAAUD,EAASnH,QAASD,GAAUK,KAASJ,QAChF3C,YAAoBsB,IAAXtB,EAAwB+C,KAAS/C,OAASA,KAGvDoI,EAAS6B,aAAeH,GAAWjC,EAAUqC,SAC7CrC,EAAUqC,QAAQC,cAAc,CAAE5H,OAAMuH,UAASnH,QAASD,GAAUK,KAASJ,QAAS3C,YAWxFoE,GAAW,WAAqB,IAApBgG,EAAoB,uDAAT,MACrBjI,GAAkBA,EAAcmC,OAAS,GAAM8F,IAC/CpC,EAASqC,YAAoBD,GAAYjI,GAAgBO,IAAS4H,KAAK,WACnEtC,EAAS7C,YAAa,CAAEnF,SAAQ2C,QAASD,EAAQD,UAAWD,EAAUD,KAAM,KAEtEyF,GADK,IAAXtF,EACe6H,0BAAgB,CACvBC,QAAS,UACTC,MAAO3G,EAAKC,cACRC,IAAS0G,4BACT,CAAErF,MAAOlD,EAAcmC,QAAW8F,GAAY,GAAM,MAGjDG,0BAAgB,CACvBC,QAAS,UACTC,MAAO3G,EAAKC,cACRC,IAAS2G,gCACT,CAAEtF,MAAOlD,EAAcmC,QAAW8F,GAAY,GAAM,IAExDQ,YAAa9G,EAAKC,cAAcC,IAAS6G,mCAEjDnG,EAAiB,OAK7B,OACI,kBAAC,WAAD,KACI,kBAACoG,EAAA,EAAD,CAAqBC,gBAAgB,IACrC,kBAAC,OAAD,KACMtD,GACE,kBAACA,EAAD,CACIuD,IAAKnD,EACL7C,MAAOA,GACPzC,KAAM6F,GAAYA,EAAS7F,MAAQ,EACnCuH,QAAS1B,GAAYA,EAAS3F,WAAa,GAC3CwI,MAAO7C,GAAYA,EAAS6B,aAAe,EAC3C/D,UAAWA,GACXgF,UAAa7C,EACb8C,YAAgC,IAAnBtI,EAAQyB,OACrBoB,QAAS0F,YAAsBhH,GAAU1B,IAExCG,EAAQX,MAAS,kBAAC,EAAD,CACda,OAASA,GACTF,QAAWA,EACXyD,WAAcA,EACdnE,cAAiBA,GAAiB,GAClCuC,iBAAoBA,EACpBD,UAAcA,EACdhB,UAAYA,EACZkB,QAAUA,EACVP,SAAaA,GACb8B,UAAaA,GACb9D,aA1DH,SAACiJ,EAAWvK,GACxBA,IAAWA,EAAU,IAE1B4D,EAAiB5D,UAgEzByG,EAAYR,UAAa,CACrBS,SAAUT,IAAUK,OACpBtD,KAAMiD,IAAUI,KAELG,sBAAWC","file":"js/Systems.js","sourcesContent":["// Initial State\nexport const init = {\n    columns: [],\n    rows: [],\n    entities: [],\n    selectedRows: []\n};\n// Reducer\n\nfunction modifyInventory(columns, state) {\n    if (!state.selectedRows) {state.selectedRows = [];}\n\n    if (state.loaded) {\n        const lastSeenColumn = state.columns.filter(({ key }) => key === 'updated');\n        return {\n            ...state,\n            rows: state.rows.map(item => ({ ...item, selected: state.selectedRows.some(system => system === item.id) })),\n            columns: [\n                ...columns || [],\n                ...lastSeenColumn || []\n            ]\n        };\n    }\n\n    return state;\n}\n\nfunction selectEntities(state, selected) {\n    const myRows = state.rows.slice();\n    if (!state.selectedRows) {state.selectedRows = [];}\n\n    const retval = {\n        ...state,\n        rows: myRows\n        .map(item => {\n            const newValue =  { ...item, selected: selected.some(system => system === item.id) };\n            return newValue;\n        }),\n        selectedRows: [...selected]\n    };\n    return retval;\n}\n\nexport const inventoryEntitiesReducer = (columns) => (state = init, action) => {\n    switch (action.type) {\n        case 'LOAD_ENTITIES_FULFILLED':\n            return modifyInventory(columns, state);\n        case 'SELECT_MULTIPLE_ENTITIES':\n            return selectEntities(state, action.payload);\n        case 'EXPAND_ROW':\n            return {\n                ...state,\n                rows: state.rows.map(row => ({\n                    ...row,\n                    isOpen: row.id === action.payload.id ? action.payload.isOpen : row.isOpen\n                }))\n            };\n        default:\n            return state;\n    }\n};\n","\nvar content = require(\"!!../../../../node_modules/css-loader/index.js!../../../../node_modules/sass-loader/lib/loader.js??ref--5-2!./Systems.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../node_modules/css-loader/index.js!../../../../node_modules/sass-loader/lib/loader.js??ref--5-2!./Systems.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../node_modules/css-loader/index.js!../../../../node_modules/sass-loader/lib/loader.js??ref--5-2!./Systems.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".systems-toolbar > div {\\n  margin-right: var(--pf-global--spacer--sm); }\\n\\n.space-between-toolbar-items {\\n  justify-content: space-between;\\n  flex-wrap: nowrap; }\\n  .space-between-toolbar-items > div {\\n    flex-wrap: nowrap; }\\n\\n.vulnerability-toolbar-spacing {\\n  justify-content: flex-start; }\\n  .vulnerability-toolbar-spacing > div:not(:last-child) {\\n    margin-right: var(--pf-global--spacer--sm); }\\n\\n.system-filter-chips {\\n  order: 6;\\n  flex-basis: 100%; }\\n\", \"\"]);\n\n// exports\n","import './Systems.scss';\nimport qs from 'query-string';\nimport propTypes from 'prop-types';\nimport React, { useState } from 'react';\nimport { injectIntl } from 'react-intl';\nimport messages from '../../../Messages';\nimport { withRouter } from 'react-router-dom';\nimport { dataShape } from '../../../Helpers/MiscHelper';\nimport { fetchSystems } from '../../../Store/Actions/Actions';\nimport { middlewareListener } from '../../../Utilities/ReducerRegistry';\nimport selectAllCheckbox from '../../../Helpers/selectAllCheckboxHelper';\nimport { PrimaryToolbar } from '@redhat-cloud-services/frontend-components';\nimport searchFilter from '../../PresentationalComponents/Filters/PrimaryToolbarFilters/SearchFilter';\nimport { exportConfig, buildActiveFilters, removeFilters } from '../../../Helpers/TableToolbarHelper';\nimport DownloadReport from '../../../Helpers/DownloadReport';\n\nconst SystemsTableToolbar = (props) => {\n\n    const onSelect = (payload) => {\n        const newSelected = payload.data.selected ? [payload.data.id, ...props.selectedHosts]\n            : props.selectedHosts.filter(item => item !== payload.data.id);\n\n        props.handleSelect(false, newSelected);\n    };\n\n    // eslint-disable-next-line no-unused-vars\n    const [selectListener] = useState(middlewareListener.addNew({\n        on: 'SELECT_ENTITY',\n        callback: payload => onSelect(payload)\n    }));\n\n    const createUrlParams = allParams => {\n        const params = { ...allParams };\n        const allowedParams = ['filter', 'page', 'page_size'];\n        Object.keys(allParams).forEach(\n            key =>\n                (params[key] === undefined || params[key] === '' || !allowedParams.includes(key) || params[key] === false) &&\n                delete params[key]\n        );\n        const queryString = qs.stringify(params);\n\n        props.setFilter(allParams.filter);\n        props.history.push('?' + queryString);\n    };\n\n    const downloadReport = format => {\n        let params = { ...props.params };\n        DownloadReport.exec(fetchSystems, params,  format, 'system-list');\n    };\n\n    const handleRefresh = ({ page, page_size: pageSize, filter, opt_out: optOut }, callback) => {\n        const { meta } = props.systems;\n        if (meta.page !== page || meta.page_size !== pageSize) {\n            const config = {\n                page,\n                page_size: pageSize || meta.page_size,\n                filter,\n                opt_out: optOut || props.params().opt_out\n            };\n            createUrlParams(config);\n            if (callback) {return callback(config);}\n        }\n    };\n\n    const handleOptOut = () => {\n        props.setOptOut(!props.params().opt_out);\n        props.setSelectedHosts([]);\n        props.setPage(1);\n    };\n\n    const kebabOptions = [\n        '',\n        {\n            label: props.params().opt_out ? props.intl.formatMessage(messages.kebabResumeAnalysis)\n                : props.intl.formatMessage(messages.kebabExcludeVulnerabilityAnalysis),\n            onClick: () => props.doOptOut(),\n            props: { isDisabled: !props.selectedHosts.length }\n        },\n        {\n            label: props.params().opt_out ? props.intl.formatMessage(messages.kebabHideExcludedSystems)\n                : props.intl.formatMessage(messages.kebabShowExcludedSystems),\n            onClick: handleOptOut\n        }\n    ];\n\n    const selectOptions = selectAllCheckbox({\n        selectedItems: props.selectedHosts,\n        selectorHandler: props.handleSelect,\n        items: props.systems,\n        fetchResource: ops =>handleRefresh(ops, (config) => fetchSystems(config))\n    });\n\n    return (\n        <PrimaryToolbar\n            bulkSelect={{\n                count: props.selectedHosts.length,\n                items: selectOptions.items,\n                checked: Boolean(props.selectedHosts.length),\n                onSelect: () => selectOptions.handleOnCheckboxChange()\n            }}\n            actionsConfig={{\n                actions: kebabOptions,\n                dropdownProps: { className: 'custom-class' }\n            }}\n            filterConfig={{\n                items: [\n                    searchFilter(\n                        messages.systemsSearchName,\n                        messages.searchFilterByName,\n                        props.params().filter,\n                        (f) => handleRefresh(f, props.onRefresh)\n                    )\n                ]\n            }}\n            activeFiltersConfig={{\n                filters: buildActiveFilters(props.parameters),\n                onDelete: (e, i) => removeFilters(i, (f) => handleRefresh(f, props.onRefresh))\n            }}\n            exportConfig={exportConfig({ downloadReport })}\n        >\n        </PrimaryToolbar>\n\n    );\n\n};\n\nSystemsTableToolbar.propTypes = {\n    systems: dataShape,\n    params: propTypes.func,\n    setPage: propTypes.func,\n    setFilter: propTypes.func,\n    setOptOut: propTypes.func,\n    selectedHosts: propTypes.array,\n    setSelectedHosts: propTypes.func,\n    doOptOut: propTypes.func,\n    onRefresh: propTypes.any,\n    parameters: propTypes.object,\n    handleSelect: propTypes.func,\n    history: propTypes.object,\n    intl: propTypes.any\n};\n\nexport default withRouter(\n    injectIntl(SystemsTableToolbar)\n);\n\n","import qs from 'query-string';\nimport propTypes from 'prop-types';\nimport { injectIntl } from 'react-intl';\nimport messages from '../../../Messages';\nimport * as reactRouterDom from 'react-router-dom';\nimport * as reactCore from '@patternfly/react-core';\nimport * as reactIcons from '@patternfly/react-icons';\nimport { useDispatch, useSelector } from 'react-redux';\nimport * as pfReactTable from '@patternfly/react-table';\nimport SystemsTableToolbar from './SystemsTableToolbar';\nimport { SYSTEMS_HEADER } from '../../../Helpers/constants';\nimport ReducerRegistry from '../../../Utilities/ReducerRegistry';\nimport { Main } from '@redhat-cloud-services/frontend-components';\nimport { systemTableRowActions } from '../../../Helpers/CVEHelper';\nimport React, { useEffect, Fragment, useState, useMemo } from 'react';\nimport VulnerabilityHeader from '../VulnerabilityHeader/VulnerabilityHeader';\nimport { fetchSystems, optOutSystemsAction } from '../../../Store/Actions/Actions';\nimport { addNotification } from '@redhat-cloud-services/frontend-components-notifications';\nimport { inventoryEntitiesReducer } from '../../../Store/Reducers/InventoryEntitiesReducer';\nimport { changeSystemsParams, selectMultipleEntities } from '../../../Store/Actions/Actions';\n\nconst selectHosts = ({ data, meta }) => {\n    const items = data && data.map(item => {\n        const { cve_count: cveCount, ...rest } = item.attributes;\n        return {\n            cve_count: (meta.opt_out && 'Excluded') || cveCount,\n            id: item.attributes.inventory_id,\n            ...rest\n        };\n    });\n    return items || [];\n};\n\nconst SystemsHook = ({ intl, location }) => {\n    const [InventoryTable, setInventoryTable] = useState(() => () => <div>Loading...</div>);\n    const [filter, setFilter] = useState(qs.parse(location.search).filter);\n    const [selectedHosts, setSelectedHosts] = useState(undefined);\n    const [optOut, setOptOut] = useState(false);\n    const [page, setPage] = useState(1);\n    const [pageSize] = useState(10);\n    const inventory = React.createRef();\n    const dispatch = useDispatch();\n\n    const systems = useSelector(({ SystemsStore }) => SystemsStore.payload);\n\n    const parameters = useSelector(\n        ({ SystemsStore }) =>SystemsStore.params\n    );\n\n    const metadata = useSelector(\n        ({ SystemsStore }) => SystemsStore.metadata\n    );\n    const isLoading =  useSelector(({ SystemsStore }) => SystemsStore.isLoading);\n\n    const items = useMemo(() => selectHosts(systems), [systems]);\n\n    const params = () => ({ filter,  page_size: pageSize, opt_out: optOut, page });\n\n    useEffect(() => {\n        if (Object.keys(parameters).length !== 0 && parameters.constructor === Object) {\n            dispatch(fetchSystems(parameters));\n        }\n    }, [parameters, dispatch]);\n\n    const loadInventory = async () => {\n        const {\n            inventoryConnector,\n            mergeWithEntities,\n            mergeWithDetail\n        } = await insights.loadInventory({\n            react: React,\n            reactRouterDom,\n            reactCore,\n            reactIcons,\n            pfReactTable\n        });\n\n        ReducerRegistry.register({\n            ...mergeWithEntities(\n                inventoryEntitiesReducer(SYSTEMS_HEADER)\n            ),\n            ...mergeWithDetail()\n        });\n        const { InventoryTable } = inventoryConnector(ReducerRegistry.getStore());\n\n        setInventoryTable(() => InventoryTable);\n    };\n\n    useEffect(() => {\n        loadInventory();\n    }, []);\n\n    useEffect(()=>{\n        if (selectedHosts) {\n            dispatch(selectMultipleEntities(selectedHosts));\n        }\n    }, [selectedHosts, dispatch]);\n\n    useEffect(()=>{\n        if (!isLoading) {\n            dispatch(fetchSystems({ ...params() }));\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [optOut]);\n\n    const onRefresh = ({ page, per_page: perPage, opt_out: optOut, filter }) => {\n        if (metadata.page !== page || metadata.page_size !== perPage) {\n            dispatch(changeSystemsParams({ page, per_page: perPage, opt_out: optOut || params().opt_out,\n                filter: (filter === undefined) ? params().filter : filter }));\n        }\n\n        if (metadata.total_items <= perPage && inventory.current) {\n            inventory.current.onRefreshData({ page, perPage, opt_out: optOut || params().opt_out, filter });\n        }\n\n    };\n\n    const handleSelect = (isChecked, payload) => {\n        if (!payload) { payload = []; }\n\n        setSelectedHosts(payload);\n    };\n\n    const doOptOut = (systemId = null) => {\n        if (selectedHosts && (selectedHosts.length > 0) || systemId) {\n            dispatch(optOutSystemsAction(systemId || selectedHosts, !optOut)).then(() => {\n                dispatch(fetchSystems({ filter, opt_out: optOut, page_size: pageSize, page: 1 }));\n                optOut === false\n                    ? dispatch(addNotification({\n                        variant: 'success',\n                        title: intl.formatMessage(\n                            messages.systemsExcludedNotification,\n                            { count: selectedHosts.length || (systemId && 1) || 0 }\n                        )\n                    }))\n                    : dispatch(addNotification({\n                        variant: 'success',\n                        title: intl.formatMessage(\n                            messages.systemsResumedNotificationTitle,\n                            { count: selectedHosts.length || (systemId && 1) || 0 }\n                        ),\n                        description: intl.formatMessage(messages.systemsResumedNotificationBody)\n                    }));\n                setSelectedHosts([]);\n            });\n        }\n    };\n\n    return (\n        <Fragment>\n            <VulnerabilityHeader showBreadcrumb={false} />\n            <Main>\n                { InventoryTable &&  (\n                    <InventoryTable\n                        ref={inventory}\n                        items={items}\n                        page={metadata && metadata.page || 1 }\n                        perPage={metadata && metadata.page_size || 20}\n                        total={metadata && metadata.total_items || 0}\n                        onRefresh={onRefresh}\n                        isLoaded = {!isLoading}\n                        hasCheckbox={systems.length !== 0}\n                        actions={systemTableRowActions(doOptOut, optOut)}\n                    >\n                        {systems.data && (<SystemsTableToolbar\n                            params= {params}\n                            systems = {systems}\n                            parameters = {parameters}\n                            selectedHosts = {selectedHosts || []}\n                            setSelectedHosts = {setSelectedHosts}\n                            setOptOut = { setOptOut }\n                            setFilter ={setFilter}\n                            setPage ={setPage}\n                            doOptOut = { doOptOut}\n                            onRefresh = {onRefresh}\n                            handleSelect = {handleSelect}\n                        />)}\n                    </InventoryTable>\n                )}\n            </Main>\n        </Fragment>\n    );\n};\n\nSystemsHook.propTypes  = {\n    location: propTypes.object,\n    intl: propTypes.any\n};\nexport default injectIntl(SystemsHook);\n"],"sourceRoot":""}