{"version":3,"sources":["webpack://@redhat-cloud-services/frontend-components-inventory-vulnerabilities/./src/Components/PresentationalComponents/Filters/PrimaryToolbarFilters/ExcludedFilter.js","webpack://@redhat-cloud-services/frontend-components-inventory-vulnerabilities/./src/Components/SmartComponents/SystemsPage/SystemsTableToolbar.js","webpack://@redhat-cloud-services/frontend-components-inventory-vulnerabilities/./src/Components/PresentationalComponents/ErrorHandler/ErrorHandler.js","webpack://@redhat-cloud-services/frontend-components-inventory-vulnerabilities/./src/Components/SmartComponents/SystemsPage/SystemsPage.js"],"names":["apply","currentFilter","currentValue","excluded","filterByExcluded","values","defaultValues","forEach","item","filter","join","page","label","intl","messages","type","conditionalFilterType","urlParam","filterValues","onChange","event","value","items","EXCLUDED_FILTER_OPTIONS","split","flatMap","index","toLowerCase","toString","SystemsTableToolbar","selectedHosts","parameters","systems","methods","useState","exportPDF","setExportPDF","handleSelect","doOptOut","middlewareListener","on","callback","payload","newSelected","data","selected","id","onSelect","kebabProps","useMemo","selectedHostsData","s","includes","selectedExcluded","some","attributes","opt_out","selectedIncluded","kebabOptions","formatMessage","count","length","onClick","props","isDisabled","selectOptions","selectAllCheckbox","selectedItems","selectorHandler","fetchResource","ops","fetchSystemsIds","Fragment","PrimaryToolbar","bulkSelect","meta","total_items","checked","Boolean","ouiaId","handleOnCheckboxChange","actionsConfig","actions","dropdownProps","filterConfig","searchFilter","excludedFilter","activeFiltersConfig","filters","buildActiveFilters","onDelete","e","i","removeFilters","exportConfig","extraItems","kebabItemDownloadPDF","downloadReport","format","params","DownloadReport","fetchSystems","DownloadCVEsReport","showButton","onSuccess","propTypes","dataShape","withRouter","injectIntl","ErrorHandler","code","Unavailable","InvalidObject","ErrorState","SystemsPage","undefined","setSelectedHosts","useUrlParams","SYSTEMS_ALLOWED_PARAMS","urlParameters","setUrlParams","inventory","React","dispatch","useDispatch","useSelector","SystemsPageStore","metadata","error","hasError","errorCode","isLoading","map","cveCount","cve_count","rest","inventory_id","useEffect","clearSystemStore","clearInventoryStore","selectMultipleEntities","config","changeSystemsParams","clearNotifications","current","systemId","optOut","optOutSystemsAction","then","addNotification","variant","title","description","Header","showBreadcrumb","Main","Inventory","onLoad","mergeWithEntities","mergeWithDetail","ReducerRegistry","inventoryEntitiesReducer","SYSTEMS_HEADER","tableProps","isStickyHeader","canSelectAll","onSort","direction","handleSortColumn","SYSTEMS_SORTING_HEADER","sort","sortBy","createSortBy","actionResolver","rowData","systemTableRowActions","showTags","isFullView","ref","perPage","page_size","total","onRefresh","pageSize","per_page","limit","onRefreshData","isLoaded","hasCheckbox","isChecked"],"mappings":"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","file":"js/Systems.c1e63f065cdc457f3c4c.js","sourcesContent":["import { conditionalFilterType } from '@redhat-cloud-services/frontend-components';\nimport { intl } from '../../../../Utilities/IntlProvider';\nimport messages from '../../../../Messages';\nimport { EXCLUDED_FILTER_OPTIONS } from '../../../../Helpers/constants';\n\nconst excludedFilter = (apply, currentFilter = {}) => {\n    let { excluded: currentValue } = currentFilter;\n\n    const filterByExcluded = (values) => {\n        const defaultValues = [false, false];\n        values.forEach(item => { defaultValues[item] = true; });\n        const filter = defaultValues.join(',');\n        apply({ excluded: filter === 'false,false' ? '' : filter, page: 1 });\n    };\n\n    return {\n        label: intl.formatMessage(messages.systemsIncludedInAnalysis),\n        type: conditionalFilterType.checkbox,\n        urlParam: 'excluded',\n        filterValues: {\n            onChange: (event, value) => {\n                filterByExcluded(value);\n            },\n            items: EXCLUDED_FILTER_OPTIONS.map(item => ({ label: item.label, value: item.value })),\n            value: currentValue?.split(',').flatMap((value, index) => value?.toLowerCase() === 'true' ? index.toString() : [])\n        }\n    };\n};\n\nexport default excludedFilter;\n","import React, { Fragment, useState, useMemo } from 'react';\nimport propTypes from 'prop-types';\nimport { injectIntl } from 'react-intl';\nimport messages from '../../../Messages';\nimport { withRouter } from 'react-router-dom';\nimport { dataShape } from '../../../Helpers/MiscHelper';\nimport { fetchSystems, fetchSystemsIds } from '../../../Store/Actions/Actions';\nimport { middlewareListener } from '../../../Utilities/ReducerRegistry';\nimport selectAllCheckbox from '../../../Helpers/selectAllCheckboxHelper';\nimport { PrimaryToolbar } from '@redhat-cloud-services/frontend-components';\nimport searchFilter from '../../PresentationalComponents/Filters/PrimaryToolbarFilters/SearchFilter';\nimport { exportConfig, buildActiveFilters, removeFilters } from '../../../Helpers/TableToolbarHelper';\nimport DownloadReport from '../../../Helpers/DownloadReport';\nimport DownloadCVEsReport from '../Reports/DownloadCVEsReport';\nimport { kebabItemDownloadPDF } from '../../PresentationalComponents/DownloadReportKebab/KebabItems';\nimport excludedFilter from '../../PresentationalComponents/Filters/PrimaryToolbarFilters/ExcludedFilter';\n\nconst SystemsTableToolbar = ({ selectedHosts, intl, parameters, systems, methods }) => {\n    const [exportPDF, setExportPDF] = useState(false);\n\n    const { apply, handleSelect, doOptOut } = methods;\n\n    const onSelect = (payload) => {\n        const newSelected = payload.data.selected ? [payload.data.id, ...selectedHosts]\n            : selectedHosts.filter(item => item !== payload.data.id);\n\n        handleSelect(false, newSelected);\n    };\n\n    middlewareListener.addNew({\n        on: 'SELECT_ENTITY',\n        callback: payload => onSelect(payload)\n    });\n\n    const downloadReport = format => {\n        let params = { ...parameters };\n        DownloadReport.exec(fetchSystems, params,  format, 'system-list');\n    };\n\n    const kebabProps = useMemo(() => {\n        const selectedHostsData = systems?.data.filter(s => selectedHosts.includes(s.id));\n        return {\n            selectedExcluded: selectedHostsData.some(s => s.attributes.opt_out === true),\n            selectedIncluded: selectedHostsData.some(s => s.attributes.opt_out === false)\n        };\n    }, [selectedHosts, systems]);\n\n    const kebabOptions = [\n        '',\n        {\n            label: intl.formatMessage(messages.systemKebabExcludeAnalysis, { count: selectedHosts.length || 0 }),\n            onClick: () => doOptOut(null, true),\n            props: { isDisabled: !selectedHosts.length || !kebabProps.selectedIncluded }\n        },\n        {\n            label: intl.formatMessage(messages.systemKebabIncludeAnalysis, { count: selectedHosts.length || 0 }),\n            onClick: () => doOptOut(null, false),\n            props: { isDisabled: !selectedHosts.length || !kebabProps.selectedExcluded }\n        }\n    ];\n\n    const selectOptions = selectAllCheckbox({\n        selectedItems: selectedHosts,\n        selectorHandler: handleSelect,\n        items: systems,\n        fetchResource: ops => fetchSystemsIds({ ...parameters, ...ops })\n    });\n\n    return <Fragment>\n        <PrimaryToolbar\n            bulkSelect={{\n                count: selectedHosts.length,\n                items: selectOptions.items,\n                isDisabled: systems.meta.total_items === 0 && selectedHosts.length === 0,\n                checked: Boolean(selectedHosts.length),\n                ouiaId: 'bulk-select',\n                onSelect: () => selectOptions.handleOnCheckboxChange()\n            }}\n            actionsConfig={{\n                actions: kebabOptions,\n                dropdownProps: { ouiaId: 'toolbar-actions' }\n            }}\n            filterConfig={{\n                items: [\n                    searchFilter(\n                        'filter',\n                        messages.systemsSearchName,\n                        messages.searchFilterByName,\n                        parameters.filter,\n                        apply\n                    ),\n                    excludedFilter(apply, parameters)\n                ]\n            }}\n            activeFiltersConfig={{\n                filters: buildActiveFilters(parameters),\n                onDelete: (e, i) => removeFilters(i, apply)\n            }}\n            exportConfig={{\n                isDisabled: systems.meta.total_items === 0,\n                extraItems: [kebabItemDownloadPDF(exportPDF, setExportPDF)],\n                ouiaId: 'export',\n                ...exportConfig({ downloadReport })\n            }}\n        />\n\n        { exportPDF &&\n            <DownloadCVEsReport\n                type='systems'\n                showButton={false}\n                params={parameters}\n                filters={buildActiveFilters(parameters)}\n                onSuccess={() => setExportPDF(false)}\n            />\n        }\n\n    </Fragment>;\n\n};\n\nSystemsTableToolbar.propTypes = {\n    systems: dataShape,\n    parameters: propTypes.object,\n    selectedHosts: propTypes.array,\n    methods: propTypes.shape({\n        doOptOut: propTypes.func,\n        apply: propTypes.func,\n        handleSelect: propTypes.func\n    }),\n    intl: propTypes.any\n};\n\nexport default withRouter(\n    injectIntl(SystemsTableToolbar)\n);\n\n","import React from 'react';\nimport propTypes from 'prop-types';\nimport {\n    InvalidObject,\n    Unavailable,\n    ErrorState\n} from '@redhat-cloud-services/frontend-components';\n\nconst ErrorHandler = ({ code }) => {\n    switch (code) {\n        case 500:\n            return <Unavailable />;\n        case 503:\n            return <Unavailable />;\n        case 404:\n            return <InvalidObject />;\n        case 400:\n            return <ErrorState />;\n        default:\n            return <ErrorState/>;\n    }\n};\n\nErrorHandler.propTypes = {\n    code: propTypes.number\n};\n\nexport default ErrorHandler;\n","import React, { useEffect, Fragment, useState, useMemo } from 'react';\nimport propTypes from 'prop-types';\nimport { injectIntl } from 'react-intl';\nimport messages from '../../../Messages';\nimport { useDispatch, useSelector } from 'react-redux';\nimport SystemsTableToolbar from './SystemsTableToolbar';\nimport { SYSTEMS_HEADER, SYSTEMS_ALLOWED_PARAMS, SYSTEMS_SORTING_HEADER } from '../../../Helpers/constants';\nimport ReducerRegistry from '../../../Utilities/ReducerRegistry';\nimport { Main } from '@redhat-cloud-services/frontend-components';\nimport { systemTableRowActions } from '../../../Helpers/CVEHelper';\nimport Header from '../../PresentationalComponents/Header/Header';\nimport { fetchSystems, optOutSystemsAction } from '../../../Store/Actions/Actions';\nimport { addNotification, clearNotifications } from '@redhat-cloud-services/frontend-components-notifications/cjs/actions';\nimport { inventoryEntitiesReducer } from '../../../Store/Reducers/InventoryEntitiesReducer';\nimport {\n    changeSystemsParams,\n    selectMultipleEntities,\n    clearSystemStore,\n    clearInventoryStore\n} from '../../../Store/Actions/Actions';\nimport { useUrlParams, createSortBy, handleSortColumn } from '../../../Helpers/MiscHelper';\nimport { InventoryTable } from '@redhat-cloud-services/frontend-components/components/esm/Inventory';\nimport ErrorHandler from '../../PresentationalComponents/ErrorHandler/ErrorHandler';\n\nconst createRows = ({ data }) => {\n    const items = data?.map(item => {\n        const { cve_count: cveCount, ...rest } = item.attributes;\n        return {\n            cve_count: cveCount,\n            id: item.attributes.inventory_id,\n            ...rest\n        };\n    });\n    return items || [];\n};\n\nconst SystemsPage = ({ intl }) => {\n    const [selectedHosts, setSelectedHosts] = useState(undefined);\n    const [urlParameters, setUrlParams] = useUrlParams(SYSTEMS_ALLOWED_PARAMS);\n    const inventory = React.createRef();\n    const dispatch = useDispatch();\n\n    const systems = useSelector(({ SystemsPageStore }) => SystemsPageStore.payload);\n\n    const parameters = useSelector(\n        ({ SystemsPageStore }) => SystemsPageStore.params\n    );\n\n    const metadata = useSelector(\n        ({ SystemsPageStore }) => SystemsPageStore.metadata\n    );\n\n    const { hasError, errorCode } = useSelector(\n        ({ SystemsPageStore }) => SystemsPageStore.error\n    );\n\n    const isLoading =  useSelector(({ SystemsPageStore }) => SystemsPageStore.isLoading);\n\n    const items = useMemo(() => createRows(systems), [systems]);\n\n    useEffect(() => {\n        return () => {\n            dispatch(clearSystemStore());\n            dispatch(clearInventoryStore());\n        };\n    }, [dispatch]);\n\n    useEffect(()=>{\n        if (selectedHosts) {\n            dispatch(selectMultipleEntities(selectedHosts));\n        }\n    }, [selectedHosts, dispatch]);\n\n    const apply = (config) => {\n        dispatch(changeSystemsParams(config));\n    };\n\n    useEffect(() => {\n        dispatch(clearNotifications());\n    }, [hasError, dispatch]);\n\n    //DRY: SystemsExposed page has also the same function\n    const inventoryRefresh = ({ page, per_page: pageSize }) => {\n        if (metadata.page !== page || metadata.limit !== pageSize) {\n            apply({ page, page_size: pageSize });\n        }\n\n        if (metadata && metadata.total_items <= pageSize && inventory.current) {\n            inventory.current.onRefreshData({ page, page_size: pageSize });\n        }\n    };\n\n    useEffect(() => {\n        if (!inventory.current) {\n            apply(urlParameters);\n        }\n        else {\n            dispatch(fetchSystems(parameters));\n            setUrlParams({ ...parameters });\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [parameters]);\n\n    const handleSelect = (isChecked, payload) => {\n        if (!payload) { payload = []; }\n\n        setSelectedHosts(payload);\n    };\n\n    const doOptOut = (systemId = null, optOut) => {\n        if (selectedHosts && (selectedHosts.length > 0) || systemId) {\n            dispatch(optOutSystemsAction(systemId || selectedHosts, optOut)).then(() => {\n                dispatch(fetchSystems({ ...parameters, page: 1 }));\n                parameters.opt_out === false\n                    ? dispatch(addNotification({\n                        variant: 'success',\n                        title: intl.formatMessage(\n                            messages.systemsExcludedNotification,\n                            { count: systemId ? 1 : selectedHosts.length || 0 }\n                        )\n                    }))\n                    : dispatch(addNotification({\n                        variant: 'success',\n                        title: intl.formatMessage(\n                            messages.systemsResumedNotificationTitle,\n                            { count: systemId ? 1 : selectedHosts.length || 0 }\n                        ),\n                        description: intl.formatMessage(messages.systemsResumedNotificationBody)\n                    }));\n                setSelectedHosts([]);\n            });\n        }\n    };\n\n    const sortBy = () =>\n        createSortBy(\n            SYSTEMS_SORTING_HEADER,\n            metadata.sort\n        );\n\n    const onSort = (event, index, direction) =>\n        handleSortColumn(\n            index,\n            direction,\n            SYSTEMS_SORTING_HEADER,\n            urlParameters.sort,\n            apply\n        );\n\n    return (\n        <Fragment>\n            <Header title={intl.formatMessage(messages.systemsHeader)} showBreadcrumb={false} />\n            <Main>\n                <Fragment>\n                    { hasError && <ErrorHandler code={errorCode} />}\n                    { !hasError && (\n                        <InventoryTable\n                            onLoad={({ mergeWithEntities, mergeWithDetail }) => {\n                                ReducerRegistry.register({\n                                    ...mergeWithEntities(\n                                        inventoryEntitiesReducer(SYSTEMS_HEADER)\n                                    ),\n                                    ...mergeWithDetail()\n                                });\n                            }}\n                            tableProps={{\n                                isStickyHeader: true,\n                                canSelectAll: false,\n                                onSort: (items.length > 0) && onSort,\n                                sortBy: (items.length > 0) && sortBy(),\n                                actionResolver: (rowData) => systemTableRowActions(rowData,  doOptOut)\n                            }}\n                            showTags\n                            isFullView\n                            ref={inventory}\n                            items={items}\n                            page={metadata && metadata.page || 1 }\n                            perPage={metadata && metadata.page_size || 20}\n                            total={metadata && metadata.total_items || 0}\n                            onRefresh={inventoryRefresh}\n                            isLoaded = {!isLoading}\n                            hasCheckbox={systems.length !== 0}\n                        >\n                            {systems.data && (<SystemsTableToolbar\n                                parameters = {parameters}\n                                systems = {systems}\n                                selectedHosts = {selectedHosts || []}\n                                methods = {{\n                                    doOptOut,\n                                    apply,\n                                    handleSelect,\n                                    setSelectedHosts\n                                }}\n                                actions\n                            />)}\n                        </InventoryTable>\n                    )}\n                </Fragment>\n            </Main>\n        </Fragment>\n    );\n};\n\nSystemsPage.propTypes  = {\n    intl: propTypes.any\n};\n\nexport default injectIntl(SystemsPage);\n"],"sourceRoot":""}